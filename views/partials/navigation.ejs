<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
    <div class="container-fluid px-5">
        <!-- Brand -->
        <a class="navbar-brand fw-bold d-flex align-items-center" href="<%= (typeof lang !== 'undefined' && lang === 'vi') ? '/docs/vi' : '/docs' %>">
            <img src="/logo.png" alt="ProgressMark" class="navbar-logo me-2" style="height: 32px; width: auto;" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
            <i class="bi bi-rocket-takeoff me-2" style="display: none; height: 32px; width: 32px; font-size: 1.5rem;"></i>
            <span class="brand-text">ProgressMark API</span>
        </a>

        <!-- Mobile Toggle -->
        <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Navigation Menu -->
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link" href="<%= (typeof lang !== 'undefined' && lang === 'vi') ? '/docs/vi' : '/docs' %>">
                        <i class="bi bi-book me-1"></i><%= (typeof lang !== 'undefined' && lang === 'vi') ? 'Tài liệu' : 'Documentation' %>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="<%= (typeof lang !== 'undefined' && lang === 'vi') ? '/docs/vi/tester' : '/docs/tester' %>">
                        <i class="bi bi-tools me-1"></i><%= (typeof lang !== 'undefined' && lang === 'vi') ? 'API Tester' : 'API Tester' %>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="<%= (typeof lang !== 'undefined' && lang === 'vi') ? '/docs/vi/demo' : '/docs/demo' %>">
                        <i class="bi bi-play-circle me-1"></i><%= (typeof lang !== 'undefined' && lang === 'vi') ? 'Demo' : 'Demo' %>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="<%= (typeof lang !== 'undefined' && lang === 'vi') ? '/docs/vi/architecture' : '/docs/architecture' %>">
                        <i class="bi bi-diagram-3 me-1"></i><%= (typeof lang !== 'undefined' && lang === 'vi') ? 'Kiến trúc' : 'Architecture' %>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="<%= (typeof lang !== 'undefined' && lang === 'vi') ? '/docs/vi/workflow' : '/docs/workflow' %>">
                        <i class="bi bi-diagram-2 me-1"></i><%= (typeof lang !== 'undefined' && lang === 'vi') ? 'Luồng hoạt động' : 'Workflow' %>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/health">
                        <i class="bi bi-heart-pulse me-1"></i><%= (typeof lang !== 'undefined' && lang === 'vi') ? 'Kiểm tra Sức khỏe' : 'Health Check' %>
                    </a>
                </li>
            </ul>

            <!-- Language Switcher -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="/docs">
                        <i class="bi bi-flag me-1"></i>🇺🇸 English
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/docs/vi">
                        <i class="bi bi-flag me-1"></i>🇻🇳 Tiếng Việt
                    </a>
                </li>
            </ul>

        </div>
    </div>
</nav>

<!-- Mobile Navigation Styles -->
<style>
/* Mobile Navigation Improvements */
@media (max-width: 991.98px) {
    .navbar {
        padding: 0.5rem 1rem;
    }
    
    .navbar-brand {
        font-size: 1.1rem;
    }
    
    .navbar-logo {
        height: 28px !important;
    }
    
    .brand-text {
        font-size: 0.9rem;
    }
    
    .navbar-toggler {
        padding: 0.25rem 0.5rem;
        font-size: 1rem;
        border: none;
        background: transparent;
        cursor: pointer;
    }
    
    .navbar-toggler:focus {
        box-shadow: none;
        outline: none;
    }
    
    .navbar-toggler:focus-visible {
        outline: 2px solid rgba(255, 255, 255, 0.5);
        outline-offset: 2px;
    }
    
    .navbar-toggler-icon {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%28255, 255, 255, 1%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
        width: 1.5em;
        height: 1.5em;
        transition: transform 0.3s ease;
    }
    
    .navbar-toggler.active {
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 0.375rem;
    }
    
    .navbar-toggler.active .navbar-toggler-icon {
        transform: rotate(45deg);
    }
    
    .navbar-collapse {
        background: linear-gradient(135deg, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.8) 100%);
        margin-top: 0.75rem;
        padding: 0;
        border-radius: 0.75rem;
        max-height: 0;
        overflow: hidden;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .navbar-collapse.show {
        max-height: 600px;
        padding: 1.5rem 1rem;
    }
    
    .navbar-nav .nav-link {
        padding: 0.6rem 0.75rem;
        margin: 0.25rem 0;
        border-radius: 0.5rem;
        border-bottom: none;
        font-size: 0.9rem;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.9);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        position: relative;
        overflow: hidden;
    }
    
    .navbar-nav .nav-link::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        transition: left 0.5s ease;
    }
    
    .navbar-nav .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.15);
        color: white;
        transform: translateX(5px);
    }
    
    .navbar-nav .nav-link:hover::before {
        left: 100%;
    }
    
    .navbar-nav .nav-link i {
        margin-right: 0.5rem;
        font-size: 0.8rem;
        width: 16px;
        text-align: center;
    }
    
    /* Language switcher on mobile */
    .navbar-nav .nav-item:has(.nav-link[href*="/docs"]) {
        border-top: 1px solid rgba(255, 255, 255, 0.2);
        margin-top: 0.75rem;
        padding-top: 0.75rem;
    }
    
    /* Language switcher styling */
    .navbar-nav .nav-item:has(.nav-link[href*="/docs"]) .nav-link {
        font-size: 0.85rem;
        padding: 0.5rem 0.75rem;
        background-color: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .navbar-nav .nav-item:has(.nav-link[href*="/docs"]) .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.2);
        border-color: rgba(255, 255, 255, 0.3);
    }
    
    /* Menu animation */
    .navbar-collapse.show .navbar-nav .nav-link {
        animation: slideInFromTop 0.3s ease forwards;
        opacity: 0;
    }
    
    .navbar-collapse.show .navbar-nav .nav-link:nth-child(1) { animation-delay: 0.1s; }
    .navbar-collapse.show .navbar-nav .nav-link:nth-child(2) { animation-delay: 0.15s; }
    .navbar-collapse.show .navbar-nav .nav-link:nth-child(3) { animation-delay: 0.2s; }
    .navbar-collapse.show .navbar-nav .nav-link:nth-child(4) { animation-delay: 0.25s; }
    .navbar-collapse.show .navbar-nav .nav-link:nth-child(5) { animation-delay: 0.3s; }
    .navbar-collapse.show .navbar-nav .nav-link:nth-child(6) { animation-delay: 0.35s; }
    .navbar-collapse.show .navbar-nav .nav-link:nth-child(7) { animation-delay: 0.4s; }
    .navbar-collapse.show .navbar-nav .nav-link:nth-child(8) { animation-delay: 0.45s; }
    
    @keyframes slideInFromTop {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
}

/* Extra small devices */
@media (max-width: 575.98px) {
    .navbar-brand {
        font-size: 0.95rem;
    }
    
    .brand-text {
        font-size: 0.8rem;
    }
    
    .navbar-logo {
        height: 22px !important;
    }
    
    .container-fluid {
        padding-left: 0.75rem;
        padding-right: 0.75rem;
    }
    
    .navbar-collapse {
        margin-top: 0.5rem;
        border-radius: 0.5rem;
    }
    
    .navbar-collapse.show {
        padding: 1rem 0.75rem;
    }
    
    .navbar-nav .nav-link {
        padding: 0.5rem 0.6rem;
        font-size: 0.85rem;
        margin: 0.2rem 0;
    }
    
    .navbar-nav .nav-link i {
        font-size: 0.75rem;
        width: 14px;
    }
    
    .navbar-nav .nav-item:has(.nav-link[href*="/docs"]) .nav-link {
        font-size: 0.8rem;
        padding: 0.4rem 0.6rem;
    }
}

/* Prevent zoom on mobile input focus */
@media (max-width: 991.98px) {
    input, select, textarea {
        font-size: 16px !important;
    }
}

/* Smooth transitions for mobile */
.navbar-collapse {
    transition: all 0.3s ease-in-out;
}

.navbar-toggler {
    transition: all 0.2s ease-in-out;
}

.navbar-toggler:hover {
    transform: scale(1.05);
}
</style>

<!-- Mobile Navigation JavaScript -->
<script>
(function() {
    'use strict';
    
    // Wait for DOM to be ready
    function ready(fn) {
        if (document.readyState !== 'loading') {
            fn();
        } else {
            document.addEventListener('DOMContentLoaded', fn);
        }
    }
    
    // Mobile menu functionality
    function initMobileMenu() {
        console.log('Initializing mobile menu...');
        
        const toggleBtn = document.querySelector('.navbar-toggler');
        const menu = document.querySelector('.navbar-collapse');
        
        if (!toggleBtn || !menu) {
            console.log('Mobile menu elements not found');
            return;
        }
        
        console.log('Mobile menu elements found');
        
        // Toggle menu function
        function toggleMenu() {
            const isOpen = menu.classList.contains('show');
            console.log('Toggling menu, currently:', isOpen ? 'OPEN' : 'CLOSED');
            
            if (isOpen) {
                menu.classList.remove('show');
                toggleBtn.setAttribute('aria-expanded', 'false');
                toggleBtn.classList.remove('active');
            } else {
                menu.classList.add('show');
                toggleBtn.setAttribute('aria-expanded', 'true');
                toggleBtn.classList.add('active');
            }
        }
        
        // Close menu function
        function closeMenu() {
            menu.classList.remove('show');
            toggleBtn.setAttribute('aria-expanded', 'false');
            toggleBtn.classList.remove('active');
        }
        
        // Add click event to toggle button
        toggleBtn.addEventListener('click', function(e) {
            console.log('Toggle button clicked');
            e.preventDefault();
            e.stopPropagation();
            toggleMenu();
        });
        
        // Close menu when clicking outside
        document.addEventListener('click', function(e) {
            if (!toggleBtn.contains(e.target) && !menu.contains(e.target)) {
                closeMenu();
            }
        });
        
        // Close menu when clicking on nav links
        const navLinks = document.querySelectorAll('.navbar-nav .nav-link');
        navLinks.forEach(function(link) {
            link.addEventListener('click', function() {
                if (window.innerWidth < 992) {
                    closeMenu();
                }
            });
        });
        
        // Close menu on window resize to desktop
        window.addEventListener('resize', function() {
            if (window.innerWidth >= 992) {
                closeMenu();
            }
        });
        
        // Close menu on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && menu.classList.contains('show')) {
                closeMenu();
            }
        });
        
        console.log('Mobile menu initialized successfully');
    }
    
    // Initialize when ready
    ready(initMobileMenu);
    
    // Fallback initialization
    setTimeout(initMobileMenu, 500);
    
    // Debug function
    window.testMobileMenu = function() {
        console.log('=== Mobile Menu Test ===');
        const toggleBtn = document.querySelector('.navbar-toggler');
        const menu = document.querySelector('.navbar-collapse');
        
        if (toggleBtn && menu) {
            console.log('✓ Toggle button found:', toggleBtn);
            console.log('✓ Menu found:', menu);
            console.log('✓ Menu is currently:', menu.classList.contains('show') ? 'OPEN' : 'CLOSED');
            
            // Test toggle
            console.log('Testing toggle...');
            toggleBtn.click();
            setTimeout(() => {
                console.log('✓ After click, menu is:', menu.classList.contains('show') ? 'OPEN' : 'CLOSED');
            }, 100);
        } else {
            console.log('✗ Mobile menu elements not found');
            console.log('Toggle button:', toggleBtn);
            console.log('Menu:', menu);
        }
    };
    
    // Auto-test on localhost
    setTimeout(() => {
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            console.log('Mobile menu test available: testMobileMenu()');
        }
    }, 1000);
})();
</script>
